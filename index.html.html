<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Ú¯ÛŒÙ… Ø³Ù†ØªØ± Ø§ÛŒØªØ§</title>
  
  <script src="https://developer.eitaa.com/eitaa-web-app.js"></script>
  
  <style>
    @import url('https://cdn.jsdelivr.net/gh/rastikerdar/mikhak-font/dist/Mikhak.css');

    :root {
      --primary: #FF9F1C; 
      --primary-dark: #e08605;
      --accent: #2EC4B6;
      --bg: #F0F4F8;
      --surface: #ffffff;
      --text: #102A43;
      --text-light: #627D98;
      --border: #e2e8f0;
      --radius: 20px;
      --success: #10B981;
      --danger: #EF4444;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    body {
      font-family: 'Mikhak', sans-serif;
      background-color: #121212;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      transition: background-color 0.3s;
    }

    .app-wrapper {
      width: 100%; height: 100%;
      max-width: 420px; max-height: 900px;
      background: var(--bg);
      position: relative;
      overflow: hidden;
      display: flex; flex-direction: column;
      box-shadow: 0 0 40px rgba(0,0,0,0.5);
      transition: background-color 0.3s;
    }

    @media (max-width: 450px) {
      .app-wrapper { max-width: 100%; max-height: 100%; border-radius: 0; }
    }

    .icon { width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; }
    .icon-lg { width: 48px; height: 48px; stroke-width: 1.5; }
    .icon-fill { fill: currentColor; stroke: none; }

    .view {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: var(--bg);
      display: none; flex-direction: column;
      overflow-y: auto;
      animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .view.active { display: flex; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Ù‡Ø¯Ø± */
    .profile-header {
      background: var(--surface);
      padding: 2rem 1.5rem 1rem;
      border-bottom-left-radius: 30px;
      border-bottom-right-radius: 30px;
      text-align: center;
      box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05);
      position: relative; z-index: 10;
    }
    .avatar-box {
      width: 80px; height: 80px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white; border-radius: 24px;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15); transform: rotate(-5deg);
    }
    .stats-row { display: flex; justify-content: center; gap: 2rem; margin-top: 1.5rem; margin-bottom: 1rem; }
    .stat-box { text-align: center; }
    .stat-num { font-size: 1.25rem; font-weight: 800; color: var(--text); }
    .stat-label { font-size: 0.8rem; color: var(--text-light); }

    /* ØªØ¨Ù„ÛŒØºØ§Øª */
    .ad-container {
      margin: 1.5rem;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border-radius: 20px; padding: 1rem; color: white;
      position: relative; overflow: hidden; cursor: pointer;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
      display: flex; align-items: center; gap: 15px;
    }
    .ad-container::before {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shine 3s infinite;
    }
    @keyframes shine { 100% { left: 100%; } }
    .ad-badge {
      position: absolute; top: 0; left: 0; background: #EF4444; color: white;
      font-size: 0.6rem; padding: 2px 8px; border-bottom-right-radius: 10px; font-weight: bold;
    }
    .ad-icon { background: rgba(255,255,255,0.2); width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
    .ad-content h4 { font-size: 0.95rem; margin-bottom: 2px; }
    .ad-content p { font-size: 0.75rem; opacity: 0.9; }
    .ad-arrow { margin-right: auto; font-size: 1.2rem; }

    .mini-ad {
      width: 100%; max-width: 320px; margin-top: 15px;
      background: linear-gradient(90deg, #ff512f, #dd2476);
      border-radius: 16px; padding: 10px 15px;
      display: flex; align-items: center; justify-content: space-between;
      color: white; cursor: pointer; font-size: 0.85rem; font-weight: bold;
      box-shadow: 0 4px 10px rgba(221, 36, 118, 0.3);
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

    /* Ù„ÛŒØ³Øª Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    .menu-list { padding: 0 1.5rem; display: flex; flex-direction: column; gap: 1rem; }
    .games-list { padding: 1.5rem; display: grid; gap: 1rem; }
    .game-card {
      background: var(--surface); border-radius: 24px; padding: 1.2rem;
      display: flex; align-items: center; gap: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02); cursor: pointer;
      transition: all 0.2s; border: 1px solid transparent;
    }
    .game-card:active { transform: scale(0.98); }
    .game-card:hover { border-color: var(--primary); }
    .game-icon-box { width: 56px; height: 56px; border-radius: 18px; display: flex; align-items: center; justify-content: center; color: white; }
    .game-card.locked { opacity: 0.6; filter: grayscale(1); }
    .badge-soon { background: #EF4444; color: white; font-size: 0.6rem; padding: 4px 10px; border-radius: 12px; margin-right: auto; font-weight: bold; }

    .btn {
      width: 100%; padding: 1.1rem; border: none; border-radius: 18px;
      font-family: inherit; font-weight: 700; font-size: 1rem;
      background: var(--primary); color: white; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 10px;
      box-shadow: 0 8px 20px -5px rgba(0,0,0,0.15); transition: transform 0.2s;
    }
    .btn:active { transform: scale(0.98); }
    .btn-sec { background: var(--surface); color: var(--text); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02); border: 1px solid var(--border); }
    .btn-support { background: #E0E7FF; color: #4338ca; border: 1px solid #c7d2fe; }

    .top-nav { padding: 1.2rem 1.5rem; display: flex; align-items: center; justify-content: space-between; font-weight: 800; font-size: 1.1rem; color: var(--text); }
    .nav-btn { background: var(--surface); width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    
    .help-btn-icon { color: #f59e0b; filter: drop-shadow(0 0 2px rgba(245, 158, 11, 0.5)); animation: float 3s infinite; }
    @keyframes float { 0% { transform: translateY(0); } 50% { transform: translateY(-3px); } 100% { transform: translateY(0); } }

    /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ (Ù…Ø´ØªØ±Ú©) */
    .setup-group { margin-bottom: 1.5rem; }
    .setup-title { display: block; font-weight: bold; margin-bottom: 0.8rem; color: var(--text); }
    .toggle-container { display: flex; background: var(--border); padding: 4px; border-radius: 16px; }
    .toggle-btn { flex: 1; padding: 10px; text-align: center; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 0.9rem; transition: all 0.2s; color: var(--text-light); }
    .toggle-btn.active { background: var(--surface); color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

    /* Ø¨Ø±Ø¯ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ² */
    .xo-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .board {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
      background: var(--surface); padding: 10px; border-radius: 24px;
      width: 320px; height: 320px; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.08);
    }
    .cell {
      background: var(--bg); border-radius: 16px; display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: all 0.2s;
    }
    .cell svg { width: 50%; height: 50%; opacity: 0; transform: scale(0.5); transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .cell.filled svg { opacity: 1; transform: scale(1); }
    .cell.x { color: var(--primary); }
    .cell.o { color: var(--accent); }

    /* Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡ */
    .memory-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; }
    .memory-grid {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
      width: 100%; max-width: 340px; 
      /* Aspect ratio removed to support variable rows */
    }
    .memory-card { 
        background: transparent; perspective: 1000px; cursor: pointer; border-radius: 12px; 
        aspect-ratio: 1; /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ù…Ø±Ø¨Ø¹ÛŒ Ø¨Ø§Ø´Ù†Ø¯ */
    }
    .memory-inner {
      position: relative; width: 100%; height: 100%; text-align: center;
      transition: transform 0.6s; transform-style: preserve-3d; border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .memory-card.flipped .memory-inner { transform: rotateY(180deg); }
    .memory-card.matched .memory-inner { box-shadow: 0 0 10px var(--accent); }
    .mem-face {
      position: absolute; width: 100%; height: 100%;
      -webkit-backface-visibility: hidden; backface-visibility: hidden;
      display: flex; align-items: center; justify-content: center;
      border-radius: 12px; font-size: 1.8rem;
    }
    .mem-front { background: var(--surface); color: var(--text); transform: rotateY(180deg); }
    .mem-back { background: var(--primary); color: white; font-size: 1.2rem; }

    /* Ø¨Ø§Ø²ÛŒ Ø±ÛŒØ§Ø¶ÛŒ */
    .math-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1.5rem; width: 100%; }
    .math-header { display: flex; justify-content: space-between; width: 100%; margin-bottom: 1rem; font-weight: bold; color: var(--text-light); }
    .math-level-badge { background: var(--accent); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; }
    .math-question { font-size: 3rem; font-weight: 900; margin-bottom: 2rem; color: var(--text); direction: ltr; }
    .math-timer-bar { width: 100%; height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; margin-bottom: 2rem; }
    .math-timer-fill { height: 100%; background: var(--primary); width: 100%; transition: width 0.1s linear; }
    .math-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; width: 100%; }
    .math-btn {
      padding: 1.5rem; border-radius: 20px; border: none; font-size: 2rem; cursor: pointer; transition: transform 0.1s;
      display: flex; align-items: center; justify-content: center; color: white;
    }
    .btn-true { background: var(--success); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
    .btn-false { background: var(--danger); box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }
    .math-btn:active { transform: scale(0.95); }

    /* Ù…ÙˆØ¯Ø§Ù„ Ø±Ø§Ù‡Ù†Ù…Ø§ */
    .help-modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8); z-index: 100;
      display: none; align-items: center; justify-content: center;
      animation: fadeIn 0.3s;
    }
    .help-box {
      background: var(--surface); width: 85%; max-width: 320px;
      padding: 1.5rem; border-radius: 24px; text-align: center;
    }
    .help-icon { font-size: 3rem; margin-bottom: 1rem; }
    .help-text { color: var(--text); line-height: 1.6; margin-bottom: 1.5rem; }

    /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
    .settings-section { background: var(--surface); border-radius: 20px; padding: 1.5rem; margin-bottom: 1rem; }
    .color-grid { display: flex; gap: 10px; justify-content: space-between; }
    .color-circle { width: 45px; height: 45px; border-radius: 50%; cursor: pointer; position: relative; transition: transform 0.2s; }
    .color-circle.active::after { content: 'âœ“'; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .theme-card { border: 2px solid var(--border); border-radius: 12px; padding: 10px; text-align: center; cursor: pointer; color: var(--text); }
    .theme-card.active { border-color: var(--primary); background: rgba(0,0,0,0.02); }
    .theme-preview { width: 100%; height: 60px; border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(0,0,0,0.1); }

    .toast {
      position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
      background: #102A43; color: white; padding: 12px 24px; border-radius: 30px;
      font-size: 0.9rem; pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 100;
    }
  </style>
</head>
<body>

  <div class="app-wrapper">
    
    <!-- === ØµÙØ­Ù‡ 1: Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ === -->
    <div id="view-dashboard" class="view active">
      <div class="profile-header">
        <div class="avatar-box">
          <svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        </div>
        <h2 id="username" style="color: var(--text);">Ú©Ø§Ø±Ø¨Ø± Ø§ÛŒØªØ§</h2>
        <div style="font-size: 0.85rem; color: var(--text-light); margin-top: 4px;">Ø³Ø·Ø­: Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ</div>
        
        <div class="stats-row">
          <div class="stat-box">
            <div class="stat-num" id="statWins">0</div>
            <div class="stat-label">Ø¨Ø±Ø¯</div>
          </div>
          <div class="stat-box">
            <div class="stat-num" id="statLosses">0</div>
            <div class="stat-label">Ø¨Ø§Ø®Øª</div>
          </div>
        </div>
      </div>

      <div class="menu-list">
        <button class="btn" onclick="showView('view-games')">
          <svg class="icon" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
          Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯
        </button>
        
        <!-- Ø¢ÛŒÚ©ÙˆÙ† Ú†Ø±Ø®â€ŒØ¯Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
        <button class="btn btn-sec" onclick="showView('view-settings')">
          <svg class="icon" viewBox="0 0 24 24"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
          ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        </button>

        <button class="btn btn-sec btn-support" onclick="showView('view-support')">
          <svg class="icon" viewBox="0 0 24 24"><path d="M3 18v-6a9 9 0 0 1 18 0v6"></path><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path></svg>
          Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
        </button>
      </div>

      <div class="ad-container" onclick="openLink('https://eitaa.com/mohammadrezanaseri')">
        <div class="ad-badge">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒÚ˜Ù‡</div>
        <div class="ad-icon">ğŸ</div>
        <div class="ad-content">
          <h4>Ú©Ø§Ù†Ø§Ù„ Ø±Ø³Ù…ÛŒ Ù…Ø§</h4>
          <p>Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¬ÙˆØ§ÛŒØ² Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯!</p>
        </div>
        <div class="ad-arrow">â†</div>
      </div>
    </div>

    <!-- === ØµÙØ­Ù‡ Ù„ÛŒØ³Øª Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ === -->
    <div id="view-games" class="view">
      <div class="top-nav">
        <div class="nav-btn" onclick="showView('view-dashboard')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div>
        <span>Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒ</span><div style="width: 40px;"></div>
      </div>
      <div class="games-list">
        
        <!-- Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ² - Ø¢ÛŒÚ©ÙˆÙ† Ø´Ø¨Ú©Ù‡ -->
        <div class="game-card" onclick="openXOMenu()">
          <div class="game-icon-box" style="background: rgba(var(--primary-rgb), 0.1); background: var(--surface); border: 2px solid var(--primary); color: var(--primary);">
            <svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/></svg>
          </div>
          <div style="flex: 1;"><h3 style="color: var(--text);">Ø¯ÙˆØ² (XO)</h3><p style="font-size: 0.8rem; color: var(--text-light); margin-top: 4px;">ÙÚ©Ø±ÛŒ â€¢ Ú©Ù„Ø§Ø³ÛŒÚ©</p></div>
          <svg class="icon" style="color: var(--text-light);" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
        </div>

        <!-- Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡ - Ø¢ÛŒÚ©ÙˆÙ† Ù…ØºØ² (Ø¬Ø¯ÛŒØ¯) -->
        <div class="game-card" onclick="openMemoryMenu()">
          <div class="game-icon-box" style="background: #E0E7FF; color: #4338ca;">
            <svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
          </div>
          <div style="flex: 1;"><h3 style="color: var(--text);">Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡</h3><p style="font-size: 0.8rem; color: var(--text-light); margin-top: 4px;">ØªÙ…Ø±Ú©Ø² â€¢ Ø³Ø±Ú¯Ø±Ù…ÛŒ</p></div>
          <svg class="icon" style="color: var(--text-light);" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
        </div>

        <!-- Ø¨Ø§Ø²ÛŒ Ù†Ø¨Ø±Ø¯ Ø±ÛŒØ§Ø¶ÛŒ - Ø¢ÛŒÚ©ÙˆÙ† Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ -->
        <div class="game-card" onclick="showMathMode()">
          <div class="game-icon-box" style="background: #FEE2E2; color: #EF4444;">
            <svg class="icon icon-lg" viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="8" y1="18" x2="8" y2="18"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="12" y1="18" x2="12" y2="18"/></svg>
          </div>
          <div style="flex: 1;"><h3 style="color: var(--text);">Ù†Ø¨Ø±Ø¯ Ø±ÛŒØ§Ø¶ÛŒ</h3><p style="font-size: 0.8rem; color: var(--text-light); margin-top: 4px;">Ø³Ø±Ø¹Øª Ø¹Ù…Ù„ â€¢ Ù‡ÛŒØ¬Ø§Ù†â€ŒØ§Ù†Ú¯ÛŒØ²</p></div>
          <svg class="icon" style="color: var(--text-light);" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
        </div>

        <!-- Ù…Ø§Ø± Ùˆ Ù¾Ù„Ù‡ - Ø¢ÛŒÚ©ÙˆÙ† Ø¯Ø³ØªÙ‡ Ø¨Ø§Ø²ÛŒ -->
        <div class="game-card locked" onclick="showToast('ğŸš§ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª...')">
          <div class="game-icon-box" style="background: #D1FAE5; color: #10B981;">
            <svg class="icon icon-lg" viewBox="0 0 24 24"><line x1="6" y1="12" x2="10" y2="12"/><line x1="8" y1="10" x2="8" y2="14"/><line x1="15" y1="13" x2="15.01" y2="13"/><line x1="18" y1="11" x2="18.01" y2="11"/><rect x="2" y="6" width="20" height="12" rx="2"/></svg>
          </div>
          <div style="flex: 1;"><h3 style="color: var(--text);">Ù…Ø§Ø± Ùˆ Ù¾Ù„Ù‡</h3><p style="font-size: 0.8rem; color: var(--text-light); margin-top: 4px;">Ù‡ÛŒØ¬Ø§Ù†â€ŒØ§Ù†Ú¯ÛŒØ² â€¢ Ú¯Ø±ÙˆÙ‡ÛŒ</p></div>
          <div class="badge-soon">Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ</div>
        </div>
      </div>
    </div>

    <!-- === ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø·Ø­ Ø±ÛŒØ§Ø¶ÛŒ === -->
    <div id="view-math-mode" class="view">
      <div class="top-nav">
        <div class="nav-btn" onclick="showView('view-games')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div>
        <span>Ù†ÙˆØ¹ Ù†Ø¨Ø±Ø¯ Ø±ÛŒØ§Ø¶ÛŒ</span><div style="width: 40px;"></div>
      </div>
      <div style="padding: 2rem; display: flex; flex-direction: column; gap: 1rem; flex: 1; justify-content: center;">
        <button class="btn" onclick="startMathGame('easy')" style="height: auto; padding: 1.5rem; justify-content: space-between;">
          <div style="display:flex; align-items:center; gap:12px;">
            <div style="background:rgba(255,255,255,0.2); padding:8px; border-radius:12px; font-size:1.5rem;">â•</div>
            <div style="text-align: right;"><div style="font-size: 1.1rem;">Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ</div><div style="font-size: 0.8rem; opacity: 0.8; font-weight: normal;">Ø¬Ù…Ø¹ Ùˆ ØªÙØ±ÛŒÙ‚ Ø³Ø§Ø¯Ù‡</div></div>
          </div>
          <svg class="icon" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
        </button>
        <button class="btn btn-sec" onclick="startMathGame('hard')" style="height: auto; padding: 1.5rem; justify-content: space-between;">
          <div style="display:flex; align-items:center; gap:12px;">
            <div style="background: var(--bg); padding:8px; border-radius:12px; font-size:1.5rem;">âœ–ï¸</div>
            <div style="text-align: right;"><div style="font-size: 1.1rem;">Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</div><div style="font-size: 0.8rem; color: var(--text-light); font-weight: normal;">Ø¶Ø±Ø¨ Ùˆ ØªØ±Ú©ÛŒØ¨ÛŒ</div></div>
          </div>
          <svg class="icon" style="color: var(--text-light);" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
        </button>
      </div>
    </div>

    <!-- === ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø·Ø­ Ø­Ø§ÙØ¸Ù‡ (Ø¬Ø¯ÛŒØ¯) === -->
    <div id="view-memory-setup" class="view">
        <div class="top-nav">
          <div class="nav-btn" onclick="showView('view-games')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div>
          <span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø­Ø§ÙØ¸Ù‡</span><div style="width: 40px;"></div>
        </div>
        <div style="padding: 2rem; display: flex; flex-direction: column; gap: 1rem; flex: 1; justify-content: center;">
          <div class="settings-section">
            <span class="setup-title">Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ</span>
            <div class="toggle-container">
                <div class="toggle-btn active" id="mem-easy" onclick="setMemDifficulty('easy')">Ø¢Ø³Ø§Ù†</div>
                <div class="toggle-btn" id="mem-medium" onclick="setMemDifficulty('medium')">Ù…ØªÙˆØ³Ø·</div>
                <div class="toggle-btn" id="mem-hard" onclick="setMemDifficulty('hard')">Ø³Ø®Øª</div>
            </div>
          </div>
          <button class="btn" onclick="launchMemoryGame()" style="height: auto; padding: 1.5rem; justify-content: space-between;">
            <div style="display:flex; align-items:center; gap:12px;">
              <div style="background:rgba(255,255,255,0.2); padding:8px; border-radius:12px;"><svg class="icon" viewBox="0 0 24 24"><path d="M5 3v18"/><path d="M19 3v18"/><path d="M5 9h14"/><path d="M5 15h14"/></svg></div>
              <div style="text-align: right;"><div style="font-size: 1.1rem;">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</div><div style="font-size: 0.8rem; opacity: 0.8; font-weight: normal;">Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§</div></div>
            </div>
            <svg class="icon" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
          </button>
        </div>
      </div>

    <!-- === ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ² (XO) === -->
    <div id="view-xo" class="view">
      <div class="top-nav">
        <div class="nav-btn" onclick="showView('view-xo-setup')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div>
        <span id="xoStatus">Ù†ÙˆØ¨Øª Ø¨Ø§Ø²ÛŒÚ©Ù†</span>
        <div class="nav-btn" onclick="resetXO()"><svg class="icon" viewBox="0 0 24 24"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg></div>
      </div>
      <div class="xo-area">
        <div class="board" id="board"></div>
        <div class="mini-ad" onclick="openLink('https://eitaa.com/mohammadrezanaseri')">
          <div>ğŸ“£ Ú©Ø§Ù†Ø§Ù„ Ø¬ÙˆØ§ÛŒØ² Ù…Ø§</div><div>Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯ â†</div>
        </div>
      </div>
    </div>

    <!-- === ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡ === -->
    <div id="view-memory" class="view">
      <div class="top-nav">
        <div class="nav-btn" onclick="showView('view-memory-setup')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div>
        <span id="memStatus">Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¬ÙØªâ€ŒÙ‡Ø§</span>
        <!-- Ø¯Ú©Ù…Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ (Ù„Ø§Ù…Ù¾) -->
        <div class="nav-btn" onclick="showHelp('memory')">
          <svg class="icon help-btn-icon" viewBox="0 0 24 24"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M12 2v1"/><path d="M12 7v.01"/><path d="M12 11v.01"/><path d="M15.5 12.5a3.5 3.5 0 1 0-7 0c0 3 2.5 4 3.5 5.5h.01c.9-1.5 3.5-2.5 3.5-5.5Z"/></svg>
        </div>
      </div>
      <div class="memory-area">
        <div class="memory-grid" id="memoryBoard"></div>
        <div class="mini-ad" onclick="openLink('https://eitaa.com/mohammadrezanaseri')">
          <div>ğŸ“£ Ú©Ø§Ù†Ø§Ù„ Ø¬ÙˆØ§ÛŒØ² Ù…Ø§</div><div>Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯ â†</div>
        </div>
      </div>
    </div>

    <!-- === ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ Ø±ÛŒØ§Ø¶ÛŒ === -->
    <div id="view-math" class="view">
      <div class="top-nav">
        <div class="nav-btn" onclick="showView('view-math-mode')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div>
        <span>Ù†Ø¨Ø±Ø¯ Ø±ÛŒØ§Ø¶ÛŒ</span>
        <!-- Ø¯Ú©Ù…Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ (Ù„Ø§Ù…Ù¾) -->
        <div class="nav-btn" onclick="showHelp('math')">
          <svg class="icon help-btn-icon" viewBox="0 0 24 24"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M12 2v1"/><path d="M12 7v.01"/><path d="M12 11v.01"/><path d="M15.5 12.5a3.5 3.5 0 1 0-7 0c0 3 2.5 4 3.5 5.5h.01c.9-1.5 3.5-2.5 3.5-5.5Z"/></svg>
        </div>
      </div>
      <div class="math-area">
        <div class="math-header">
          <div>Ø§Ù…ØªÛŒØ§Ø²: <span id="mathScore">0</span></div>
          <div class="math-level-badge">Ø³Ø·Ø­: <span id="mathLevel">1</span></div>
        </div>
        <div class="math-timer-bar"><div class="math-timer-fill" id="mathTimerBar"></div></div>
        <div class="math-question" id="mathQuestion">2 + 2 = 4</div>
        <div class="math-controls">
          <button class="math-btn btn-true" onclick="answerMath(true)">âœ…</button>
          <button class="math-btn btn-false" onclick="answerMath(false)">âŒ</button>
        </div>
        <div class="mini-ad" onclick="openLink('https://eitaa.com/mohammadrezanaseri')" style="margin-top: auto;">
          <div>ğŸ“£ Ú©Ø§Ù†Ø§Ù„ Ø¬ÙˆØ§ÛŒØ² Ù…Ø§</div><div>Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯ â†</div>
        </div>
      </div>
    </div>

    <!-- === ØµÙØ­Ø§Øª Ø¬Ø§Ù†Ø¨ÛŒ === -->
    <div id="view-xo-setup" class="view">
      <div class="top-nav"><div class="nav-btn" onclick="showView('view-xo-mode')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div><span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ</span><div style="width: 40px;"></div></div>
      <div style="padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; flex: 1;">
        <div class="settings-section">
          <div class="setup-group"><span class="setup-title">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‡Ø±Ù‡ Ø´Ù…Ø§</span><div class="toggle-container"><div class="toggle-btn active" id="btn-player-x" onclick="setPlayerSymbol('X')">X (Ø´Ø±ÙˆØ¹)</div><div class="toggle-btn" id="btn-player-o" onclick="setPlayerSymbol('O')">O (Ù†ÙØ± Ø¯ÙˆÙ…)</div></div></div>
          <div class="setup-group" id="difficulty-group"><span class="setup-title">Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ Ø±Ø¨Ø§Øª</span><div class="toggle-container"><div class="toggle-btn active" id="diff-easy" onclick="setDifficulty('easy')">Ø¢Ø³Ø§Ù†</div><div class="toggle-btn" id="diff-medium" onclick="setDifficulty('medium')">Ù…ØªÙˆØ³Ø·</div><div class="toggle-btn" id="diff-hard" onclick="setDifficulty('hard')">Ø³Ø®Øª</div></div></div>
        </div>
        <button class="btn" onclick="launchGame()" style="margin-top: auto;">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ ğŸš€</button>
      </div>
    </div>

    <div id="view-xo-mode" class="view">
      <div class="top-nav"><div class="nav-btn" onclick="showView('view-games')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div><span>Ù†ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ²</span><div style="width: 40px;"></div></div>
      <div style="padding: 2rem; display: flex; flex-direction: column; gap: 1rem; flex: 1; justify-content: center;">
        <button class="btn" onclick="showGameSetup('ai')" style="height: auto; padding: 1.5rem; justify-content: space-between;"><div style="display:flex; align-items:center; gap:12px;"><div style="background:rgba(255,255,255,0.2); padding:8px; border-radius:12px;"><svg class="icon" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></svg></div><div style="text-align: right;"><div style="font-size: 1.1rem;">Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø±Ø¨Ø§Øª</div><div style="font-size: 0.8rem; opacity: 0.8; font-weight: normal;">ØªÙ…Ø±ÛŒÙ†ÛŒ ØªÚ© Ù†ÙØ±Ù‡</div></div></div><svg class="icon" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></button>
        <button class="btn btn-sec" onclick="showGameSetup('local')" style="height: auto; padding: 1.5rem; justify-content: space-between;"><div style="display:flex; align-items:center; gap:12px;"><div style="background: var(--bg); padding:8px; border-radius:12px; color: var(--primary);"><svg class="icon" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div><div style="text-align: right;"><div style="font-size: 1.1rem;">Ø¨Ø§Ø²ÛŒ Ø¯Ùˆ Ù†ÙØ±Ù‡</div><div style="font-size: 0.8rem; color: var(--text-light); font-weight: normal;">Ø±ÙˆÛŒ Ù‡Ù…ÛŒÙ† Ø¯Ø³ØªÚ¯Ø§Ù‡</div></div></div><svg class="icon" style="color: var(--text-light);" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></button>
      </div>
    </div>

    <div id="view-support" class="view">
        <div class="top-nav"><div class="nav-btn" onclick="showView('view-dashboard')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div><span>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</span><div style="width: 40px;"></div></div>
        <div style="padding: 2rem; display: flex; flex-direction: column; gap: 1rem; flex: 1; justify-content: center;">
          <button class="btn" onclick="openLink('https://eitaa.com/mohammadrezanaseri')" style="height: 100px; padding: 1.5rem; justify-content: space-between; background: #e67e22;"><div style="display:flex; align-items:center; gap:15px;"><div style="background:rgba(255,255,255,0.2); width: 50px; height: 50px; display:flex; align-items:center; justify-content:center; border-radius:15px;"><svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></div><div style="text-align: right;"><div style="font-size: 1.2rem;">Ù¾ÛŒØ§Ù… Ø¯Ø± Ø§ÛŒØªØ§</div><div style="font-size: 0.85rem; opacity: 0.9; font-weight: normal;">Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ Ø³Ø±ÛŒØ¹</div></div></div><svg class="icon" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></button>
          <button class="btn" onclick="openLink('https://rubika.ir/mohammadrezNaseri')" style="height: 100px; padding: 1.5rem; justify-content: space-between; background: #8e44ad;"><div style="display:flex; align-items:center; gap:15px;"><div style="background:rgba(255,255,255,0.2); width: 50px; height: 50px; display:flex; align-items:center; justify-content:center; border-radius:15px;"><svg class="icon icon-lg" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.29 7 12 12 20.71 7"></polyline><line x1="12" y1="22" x2="12" y2="12"></line></svg></div><div style="text-align: right;"><div style="font-size: 1.2rem;">Ù¾ÛŒØ§Ù… Ø¯Ø± Ø±ÙˆØ¨ÛŒÚ©Ø§</div><div style="font-size: 0.85rem; opacity: 0.9; font-weight: normal;">Ú©Ø§Ù†Ø§Ù„ Ùˆ Ù¾ÛŒÙˆÛŒ</div></div></div><svg class="icon" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></button>
        </div>
    </div>

    <div id="view-settings" class="view">
      <div class="top-nav"><div class="nav-btn" onclick="showView('view-dashboard')"><svg class="icon" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg></div><span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span><div style="width: 40px;"></div></div>
      <div style="padding: 1.5rem;">
        <div class="settings-section"><span class="settings-title">Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡</span><div class="color-grid"><div class="color-circle" style="background: #FF9F1C;" onclick="setColor('#FF9F1C', this)"></div><div class="color-circle" style="background: #3B82F6;" onclick="setColor('#3B82F6', this)"></div><div class="color-circle" style="background: #8B5CF6;" onclick="setColor('#8B5CF6', this)"></div><div class="color-circle" style="background: #10B981;" onclick="setColor('#10B981', this)"></div><div class="color-circle" style="background: #EF4444;" onclick="setColor('#EF4444', this)"></div></div></div>
        <div class="settings-section"><span class="settings-title">ØªÙ… Ø¨Ø±Ù†Ø§Ù…Ù‡</span><div class="theme-grid"><div class="theme-card active" id="theme-light" onclick="setTheme('light')"><div class="theme-preview" style="background: #F0F4F8;"></div><div>Ø±ÙˆØ² (Ø±ÙˆØ´Ù†)</div></div><div class="theme-card" id="theme-dark" onclick="setTheme('dark')"><div class="theme-preview" style="background: #102A43;"></div><div>Ø´Ø¨ (ØªØ§Ø±ÛŒÚ©)</div></div></div></div>
        <div style="text-align: center; color: var(--text-light); font-size: 0.8rem; margin-top: 1rem;">Ù†Ø³Ø®Ù‡ 2.1.0</div>
      </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø±Ø§Ù‡Ù†Ù…Ø§ -->
    <div id="helpModal" class="help-modal">
      <div class="help-box">
        <div class="help-icon">ğŸ’¡</div>
        <h3 id="helpTitle" style="margin-bottom: 10px;">Ø±Ø§Ù‡Ù†Ù…Ø§</h3>
        <p id="helpText" class="help-text">Ù…ØªÙ† Ø±Ø§Ù‡Ù†Ù…Ø§...</p>
        <button class="btn" onclick="closeHelp()">Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…</button>
      </div>
    </div>

    <div id="toast" class="toast">Ù¾ÛŒØ§Ù…</div>
  </div>

  <script>
    // --- Eitaa SDK Integration ---
    const WebApp = window.Eitaa?.WebApp || window.Telegram?.WebApp;
    
    // Icons
    const iconX = `<svg class="icon-fill" viewBox="0 0 24 24" style="width:100%; height:100%;"><path d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 1 0-1.41 1.41L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/></svg>`;
    const iconO = `<svg class="icon-fill" viewBox="0 0 24 24" style="width:100%; height:100%;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>`;

    function playSound() { try { const c=new (window.AudioContext||window.webkitAudioContext),o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);o.frequency.value=600;g.gain.value=0.05;o.start();setTimeout(()=>{o.stop();c.close()},50) }catch(e){} }

    // --- State Management (Wins/Losses) ---
    let wins = parseInt(localStorage.getItem('userWins')) || 0;
    let losses = parseInt(localStorage.getItem('userLosses')) || 0;

    function updateStatsUI() {
        document.getElementById('statWins').innerText = wins;
        document.getElementById('statLosses').innerText = losses;
    }

    function addWin() {
        wins++; localStorage.setItem('userWins', wins); updateStatsUI();
    }

    function addLoss() {
        losses++; localStorage.setItem('userLosses', losses); updateStatsUI();
    }

    if (WebApp) {
      WebApp.ready(); WebApp.expand();
      const user = WebApp.initDataUnsafe?.user;
      if (user) document.getElementById('username').textContent = user.first_name;
      WebApp.BackButton.onClick(() => {
        playSound();
        const active = document.querySelector('.view.active').id;
        if (['view-settings','view-support','view-games','view-memory','view-math','view-math-mode','view-memory-setup'].includes(active)) showView('view-dashboard', false);
        else if (active === 'view-xo-mode') showView('view-games', false);
        else if (active === 'view-xo-setup') showView('view-xo-mode', false);
        else if (active === 'view-xo') showView('view-xo-setup', false);
        else WebApp.close();
      });
    }

    function showView(id, sound=true) {
      if(sound) playSound();
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      const isRoot = id === 'view-dashboard';
      if (WebApp && WebApp.BackButton) isRoot ? WebApp.BackButton.hide() : WebApp.BackButton.show();
      if (id !== 'view-math') clearInterval(mathTimerInterval);
    }

    function showToast(msg) {
      playSound(); const t = document.getElementById('toast'); t.innerText = msg; t.style.opacity = 1; setTimeout(() => t.style.opacity = 0, 2000);
    }
    function openLink(url) { playSound(); window.open(url, '_blank'); }

    // --- Settings & UI ---
    const root = document.documentElement;
    function setColor(color, el) { playSound(); root.style.setProperty('--primary', color); root.style.setProperty('--primary-dark', color); document.querySelectorAll('.color-circle').forEach(c => c.classList.remove('active')); if(el) el.classList.add('active'); localStorage.setItem('appColor', color); }
    function setTheme(theme) { playSound(); if (theme === 'dark') { root.style.setProperty('--bg', '#102A43'); root.style.setProperty('--surface', '#243B53'); root.style.setProperty('--text', '#F0F4F8'); root.style.setProperty('--text-light', '#9FB3C8'); root.style.setProperty('--border', '#334E68'); document.getElementById('theme-dark').classList.add('active'); document.getElementById('theme-light').classList.remove('active'); if(WebApp.setHeaderColor) WebApp.setHeaderColor('#243B53'); } else { root.style.setProperty('--bg', '#F0F4F8'); root.style.setProperty('--surface', '#ffffff'); root.style.setProperty('--text', '#102A43'); root.style.setProperty('--text-light', '#627D98'); root.style.setProperty('--border', '#e2e8f0'); document.getElementById('theme-light').classList.add('active'); document.getElementById('theme-dark').classList.remove('active'); if(WebApp.setHeaderColor) WebApp.setHeaderColor('#ffffff'); } localStorage.setItem('appTheme', theme); }
    window.addEventListener('load', () => {
      const c = localStorage.getItem('appColor')||'#FF9F1C', t = localStorage.getItem('appTheme')||'light';
      const temp=playSound; playSound=()=>{}; setColor(c); setTheme(t); playSound=temp;
      const circles = document.querySelectorAll('.color-circle'); circles.forEach(ci => { if(ci.style.background.includes(c) || (c==='#FF9F1C' && ci.style.background.includes('255, 159'))) ci.classList.add('active'); });
      updateStatsUI(); 
    });

    // --- Help System ---
    function showHelp(type) {
      playSound();
      const modal = document.getElementById('helpModal');
      const title = document.getElementById('helpTitle');
      const text = document.getElementById('helpText');
      
      if (type === 'memory') {
        title.innerText = 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡';
        text.innerText = 'Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†ÛŒØ¯ Ùˆ Ø¬ÙØªâ€ŒÙ‡Ø§ÛŒ ÛŒÚ©Ø³Ø§Ù† Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯. Ø¨Ø§ ØªÚ©Ù…ÛŒÙ„ Ø¨Ø§Ø²ÛŒØŒ Û± Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø±Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯.';
      } else if (type === 'math') {
        title.innerText = 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†Ø¨Ø±Ø¯ Ø±ÛŒØ§Ø¶ÛŒ';
        text.innerText = 'Ø¯Ø±Ø³Øª ÛŒØ§ ØºÙ„Ø· Ø¨ÙˆØ¯Ù† Ø¹Ø¨Ø§Ø±Øª Ø±Ø§ ØªØ´Ø®ÛŒØµ Ø¯Ù‡ÛŒØ¯. Ø¨Ø§Ø®ØªÙ† Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ø®Øª Ø±Ø§ Ø²ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ø³Ø·Ø­ Ûµ (Û²Û° Ø§Ù…ØªÛŒØ§Ø²) Û± Ø¨Ø±Ø¯ Ø¬Ø§ÛŒØ²Ù‡ Ø¯Ø§Ø±Ø¯.';
      }
      modal.style.display = 'flex';
    }
    function closeHelp() { document.getElementById('helpModal').style.display = 'none'; playSound(); }

    // --- XO Logic ---
    let board = [], currentPlayer = 'X', active = true, gameMode = 'ai', userSymbol = 'X', aiDifficulty = 'easy';
    function openXOMenu() { showView('view-xo-mode'); }
    function showGameSetup(mode) {
      gameMode = mode; document.getElementById('difficulty-group').style.display = (mode === 'ai') ? 'block' : 'none';
      setPlayerSymbol('X'); setDifficulty('easy'); showView('view-xo-setup');
    }
    function setPlayerSymbol(sym) { playSound(); userSymbol = sym; document.getElementById('btn-player-x').className = `toggle-btn ${sym==='X'?'active':''}`; document.getElementById('btn-player-o').className = `toggle-btn ${sym==='O'?'active':''}`; }
    function setDifficulty(diff) { playSound(); aiDifficulty = diff; document.getElementById('diff-easy').className = `toggle-btn ${diff==='easy'?'active':''}`; document.getElementById('diff-medium').className = `toggle-btn ${diff==='medium'?'active':''}`; document.getElementById('diff-hard').className = `toggle-btn ${diff==='hard'?'active':''}`; }
    function launchGame() { resetXO(); showView('view-xo'); }
    function resetXO() {
      playSound(); board = Array(9).fill(''); currentPlayer = 'X'; active = true; drawBoard(); updateStatusText();
      if (gameMode === 'ai' && userSymbol === 'O') setTimeout(aiMove, 600);
    }
    function drawBoard() {
      const b = document.getElementById('board'); b.innerHTML = '';
      board.forEach((val, i) => {
        const c = document.createElement('div'); c.className = `cell ${val ? val.toLowerCase() + ' filled' : ''}`;
        if(val === 'X') c.innerHTML = iconX; else if(val === 'O') c.innerHTML = iconO;
        c.onclick = () => move(i); b.appendChild(c);
      });
    }
    function move(i) {
      if (board[i] || !active) return;
      if (gameMode === 'ai' && currentPlayer !== userSymbol) return;
      makeMove(i);
      if (active && gameMode === 'ai') setTimeout(aiMove, 600);
    }
    function makeMove(i) {
      playSound(); board[i] = currentPlayer; drawBoard();
      if (checkWin()) {
        let winnerName = `ğŸ‰ Ø¨Ø§Ø²ÛŒÚ©Ù† ${currentPlayer} Ø¨Ø±Ø¯!`;
        if (gameMode === 'ai') {
            if (currentPlayer === userSymbol) {
                winnerName = 'ğŸ‰ Ø´Ù…Ø§ Ø¨Ø±Ø¯ÛŒØ¯!';
                addWin(); // Win for User
            } else {
                winnerName = 'ğŸ¤– Ø±Ø¨Ø§Øª Ø¨Ø±Ø¯!';
                addLoss(); // Loss for User
            }
        }
        document.getElementById('xoStatus').innerText = winnerName; active = false; 
        setTimeout(resetXO, 2000); 
        return;
      }
      if (!board.includes('')) {
        document.getElementById('xoStatus').innerText = 'ğŸ¤ Ù…Ø³Ø§ÙˆÛŒ Ø´Ø¯!'; active = false; 
        setTimeout(resetXO, 2000); 
        return;
      }
      currentPlayer = currentPlayer === 'X' ? 'O' : 'X'; updateStatusText();
    }
    function updateStatusText() {
      if (!active) return;
      if (gameMode === 'ai') document.getElementById('xoStatus').innerText = currentPlayer === userSymbol ? 'Ù†ÙˆØ¨Øª Ø´Ù…Ø§' : 'Ù†ÙˆØ¨Øª Ø±Ø¨Ø§Øª...';
      else document.getElementById('xoStatus').innerText = `Ù†ÙˆØ¨Øª Ø¨Ø§Ø²ÛŒÚ©Ù† (${currentPlayer})`;
    }
    function aiMove() {
      if (!active) return;
      const botSym = currentPlayer, oppSym = botSym === 'X' ? 'O' : 'X'; let moveIndex = null;
      if (aiDifficulty !== 'easy') moveIndex = findBestMove(botSym);
      if (moveIndex === null && aiDifficulty !== 'easy') moveIndex = findBestMove(oppSym);
      if (moveIndex === null && aiDifficulty === 'hard') {
        if (board[4] === '') moveIndex = 4;
        else { const corners = [0, 2, 6, 8].filter(idx => board[idx] === ''); if (corners.length > 0) moveIndex = corners[Math.floor(Math.random() * corners.length)]; }
      }
      if (moveIndex === null) { const empty = board.map((v, i) => v === '' ? i : null).filter(v => v !== null); if (empty.length > 0) moveIndex = empty[Math.floor(Math.random() * empty.length)]; }
      if (moveIndex !== null) makeMove(moveIndex);
    }
    function findBestMove(player) {
      const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
      for (let w of wins) { const [a, b, c] = w; if (board[a] === player && board[b] === player && board[c] === '') return c; if (board[a] === player && board[c] === player && board[b] === '') return b; if (board[b] === player && board[c] === player && board[a] === '') return a; }
      return null;
    }
    function checkWin() { const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]; return wins.some(w => board[w[0]] && board[w[0]] === board[w[1]] && board[w[0]] === board[w[2]]); }

    // --- Memory Game Logic ---
    let memCards = [], memFlipped = [], memMatched = [];
    const emojiPool = ['ğŸ•','ğŸš€','ğŸ±','ğŸŒµ','âš½','ğŸ’','ğŸˆ','ğŸ','ğŸ','ğŸš—','ğŸ¶','ğŸ¦„','ğŸ¦','ğŸ¸','â°','ğŸ’¡','ğŸ”‘','ğŸ“¸','ğŸ’Š','ğŸ§¸','â˜‚ï¸','ğŸ”¥','âš¡','â­'];
    let memoryDifficulty = 'medium';

    function openMemoryMenu() { showView('view-memory-setup'); }

    function setMemDifficulty(diff) {
        playSound(); memoryDifficulty = diff;
        document.getElementById('mem-easy').className = `toggle-btn ${diff==='easy'?'active':''}`;
        document.getElementById('mem-medium').className = `toggle-btn ${diff==='medium'?'active':''}`;
        document.getElementById('mem-hard').className = `toggle-btn ${diff==='hard'?'active':''}`;
    }

    function launchMemoryGame() {
      memFlipped = []; memMatched = [];
      let pairCount;
      if (memoryDifficulty === 'easy') pairCount = 6;
      else if (memoryDifficulty === 'medium') pairCount = 8;
      else pairCount = 10;

      // Select random emojis
      const shuffledPool = [...emojiPool].sort(() => 0.5 - Math.random());
      const selectedEmojis = shuffledPool.slice(0, pairCount);
      memCards = [...selectedEmojis, ...selectedEmojis].sort(() => 0.5 - Math.random());
      
      const board = document.getElementById('memoryBoard');
      board.innerHTML = '';
      
      // Update grid layout for difficulty
      if (memoryDifficulty === 'easy') board.style.gridTemplateColumns = 'repeat(3, 1fr)';
      else if (memoryDifficulty === 'medium') board.style.gridTemplateColumns = 'repeat(4, 1fr)';
      else board.style.gridTemplateColumns = 'repeat(4, 1fr)'; // 20 cards (5 rows)

      memCards.forEach((emoji, index) => {
        const card = document.createElement('div');
        card.className = 'memory-card';
        card.innerHTML = `<div class="memory-inner"><div class="mem-face mem-back">?</div><div class="mem-face mem-front">${emoji}</div></div>`;
        card.onclick = () => flipCard(card, index);
        board.appendChild(card);
      });
      document.getElementById('memStatus').innerText = 'Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¬ÙØªâ€ŒÙ‡Ø§';
      showView('view-memory');
    }

    function flipCard(card, index) {
      if (memFlipped.length >= 2 || memFlipped.some(c => c.index === index) || memMatched.includes(index)) return;
      playSound();
      card.classList.add('flipped');
      memFlipped.push({ card, index, emoji: memCards[index] });

      if (memFlipped.length === 2) {
        if (memFlipped[0].emoji === memFlipped[1].emoji) {
          memMatched.push(memFlipped[0].index, memFlipped[1].index);
          memFlipped[0].card.classList.add('matched');
          memFlipped[1].card.classList.add('matched');
          memFlipped = [];
          if (memMatched.length === memCards.length) { 
              document.getElementById('memStatus').innerText = 'ğŸ‰ Ø¹Ø§Ù„ÛŒ Ø¨ÙˆØ¯!';
              addWin(); 
              setTimeout(launchMemoryGame, 2000);
          }
        } else {
          setTimeout(() => {
            memFlipped.forEach(item => item.card.classList.remove('flipped'));
            memFlipped = [];
          }, 1000);
        }
      }
    }

    // --- Math Game Logic ---
    let mathScoreVal = 0, mathTimerInterval, mathCorrectAnswer = true, mathTimeLeft = 100, mathLevel = 1;
    let mathMode = 'easy'; 

    function showMathMode() { showView('view-math-mode'); }

    function startMathGame(mode) {
      mathMode = mode;
      mathScoreVal = 0; mathTimeLeft = 100; mathLevel = 1;
      document.getElementById('mathScore').innerText = '0';
      document.getElementById('mathLevel').innerText = '1';
      generateMathQuestion();
      showView('view-math');
      startMathTimer();
    }
    function startMathTimer() {
      clearInterval(mathTimerInterval);
      const bar = document.getElementById('mathTimerBar');
      mathTimerInterval = setInterval(() => {
        const dropRate = mathMode === 'hard' ? 1.2 : 0.8;
        mathTimeLeft -= dropRate; 
        bar.style.width = mathTimeLeft + '%';
        if (mathTimeLeft <= 0) endGameMath();
      }, 80); 
    }
    function generateMathQuestion() {
      let a, b, realRes, operator;
      
      if (mathMode === 'easy') {
        operator = Math.random() > 0.5 ? '+' : '-';
        a = Math.floor(Math.random() * 20) + 1;
        b = Math.floor(Math.random() * 20) + 1;
        if (operator === '-') { if(a < b) [a, b] = [b, a]; }
        realRes = operator === '+' ? a + b : a - b;
      } else {
        operator = Math.random() > 0.6 ? '*' : (Math.random() > 0.5 ? '+' : '-');
        if (operator === '*') {
            a = Math.floor(Math.random() * 9) + 2;
            b = Math.floor(Math.random() * 9) + 2;
            realRes = a * b;
            operator = 'Ã—';
        } else {
            a = Math.floor(Math.random() * 50) + 10;
            b = Math.floor(Math.random() * 50) + 10;
            if (operator === '-') { if(a < b) [a, b] = [b, a]; }
            realRes = operator === '+' ? a + b : a - b;
        }
      }

      mathCorrectAnswer = Math.random() > 0.5;
      let displayRes = realRes;
      
      if (!mathCorrectAnswer) {
        const offset = (Math.floor(Math.random() * 3) + 1) * (Math.random() > 0.5 ? 1 : -1);
        displayRes = realRes + offset;
        if(displayRes === realRes) displayRes += 1;
      }
      
      document.getElementById('mathQuestion').innerText = `${a} ${operator} ${b} = ${displayRes}`;
    }
    function answerMath(userSaidTrue) {
      playSound();
      if (userSaidTrue === mathCorrectAnswer) {
        mathScoreVal++;
        document.getElementById('mathScore').innerText = mathScoreVal;
        
        // Level Logic
        if (mathScoreVal % 5 === 0) {
            mathLevel++;
            document.getElementById('mathLevel').innerText = mathLevel;
            showToast('Ø³Ø·Ø­ Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØª! ğŸš€');
            if (mathScoreVal === 20) addWin(); // Bonus Win for passing level 5
        }

        mathTimeLeft = Math.min(100, mathTimeLeft + (mathMode==='hard'?15:20)); 
        generateMathQuestion();
      } else {
        endGameMath();
      }
    }
    function endGameMath() {
      clearInterval(mathTimerInterval);
      addLoss(); // Loss for Math
      showToast(`Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯! Ø§Ù…ØªÛŒØ§Ø²: ${mathScoreVal}`);
      setTimeout(() => showView('view-games'), 2000);
    }

    drawBoard();
  </script>
</body>
</html>